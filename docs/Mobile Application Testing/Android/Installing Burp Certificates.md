## Installing Burp Certificates
### Certificates
To successfully intercept SSL traffic we need to proxy the app with the Burp Suite Certificate. 
##### Installing Burp certificate as user-level trusted certificate
1. Start a mobile hotspot on hacktop
2. Connect to hacktop hotspot from device
3. Visit `http://burp` or `http://192.168.137.1:8080` to load the burp webpage
4. Download the certificate
5. Install the certificate: 
	1. Rename the cert extension to .cer instead of .der
	2. Go to `Settings -> Security -> Encryption and Credentials -> Install a Certificate`
	3. Select the newly downloaded cert and install it into the user certificate store

Note that this will install the Portswigger cert as a *user certificate*, if the device is not rooted.
##### Installing Burp certificate as system-level trusted certificate - Emulator
**Root the device**
https://www.youtube.com/watch?v=vO92Gs9kyfg
1. Create a emulator device that uses Google APIs prior to v28. 
2. Start the emulator device either from Android studio or command line.
3. Install Magisk from [RootAVD](https://github.com/newbit1/rootAVD.git) .
4. Run `.\rootAVD.sh` if on Linux, or `.\runAVD.bat` on Windows.

**Install the certificate**
https://www.youtube.com/watch?v=qQicUW0svB8
1. Move the burp cert (cacert.cer) to the device SD card and install it
2. Download the AlwaysTrustUserCert Magisk package and move it to the device SD card.
3. Install the AlwayTrustUserCert Magisk package on Magisk.

The Burp cert should now be a System and user trusted certificate.
##### Installing Burp certificate as a system-level trusted certificate - Physical Device
Trusted Certificate Authorities for Android are stored in `/system/etc/security/cacerts`. 

1. Export Burp cert in DER format
https://blog.ropnop.com/configuring-burp-suite-with-android-nougat
![[Pasted image 20230626101805.png]]
2. Convert the certificate to a PEM file type
```fallback
openssl x509 -inform DER -in cacert.der -out cacert.pem
```
3. Get the `subject_hash_old `value of the certificate (the hash of the certificate subject name)
```fallback
openssl x509 -inform PEM -subject_hash_old -in cacert.pem |head -1
```
4. Rename the file to the `subject_hash_old` value, appended with `.0` to the filename
```fallback
mv cacert.pem <hash>.0
```
5. Copy the certificate to the device. We need to remount the device as a writable file system, which we can do if we're root.
```fallback
adb root
adb remount
adb push <cert>.0 /sdcard/
```
6. Go into the phone's file system
```
adb shell
```
7. Move the cert to the cacerts directory and change the file permissions of the cert.
```fallback
mv /sdcard/<cert>.0 /system/etc/security/cacerts/
chmod 644 /system/etc/security/cacerts/<cert>.0
```
8. Reboot the device
```
adb reboot
```

The Portswigger cert should appear as a system certificate now.
![](Pasted%20image%2020230626103356.png)

##### Troubleshooting issues with installing system-level trusted certificates
Note that Google Pixels and emulators installed with Google APIs prevent certificates from being installed as system certificates, even with root privileges

**Testing on a physical device**
1. Jailbreak the Android device
2. Install Magisk
3. Install always trust user certificates module via Magisk 

**Testing using an emulator**
Make sure to install an emulator without Google APIs and follow the above instructions.